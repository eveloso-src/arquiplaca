<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring3-3.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout">
<head>
<title>Home Page</title>
<link rel="stylesheet" type="text/css" th:href="@{/css/home.css}" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>
	
</script>

</head>

<body>
	<header th:replace="layouts/base::header(dark)"> </header>

	<div class="container">
		<!-- 		<form id="logout" th:action="@{/logout}" method="get"> -->

		<div class="row"></div>
		<!-- 		</form> -->


		<div class="row">

			<div class="col-md-4">

				<div class="panel-group" style="margin-top: 40px">

					<div class="panel panel-primary">
						<div class="panel-heading">
							<b><span th:utext="'Nuevo Movimiento'"></span></b>
						</div>
						<div class="panel-body">

							<form id="form" th:action=" 
								@{/movement}"
								th:object="${movement}" method="post">
								<div class="row botton-padding">
									<div class="form-group col-md-4 capitalize">
										<b>Codigo: </b><input type="text" class="form-control"
											id="code" th:field="*{product.color}" name="code" required />
									</div>
									<div class="form-group capitalize" id="productDesc"></div>
								</div>

								<div class="row">
									<div class="form-group col-md-4">
										<b>Cantidad: </b><input type="number" class="form-control"
											name="amount" required id="amount" />
									</div>
									<div class="form-group col-md-4">
										<b>m2: </b><input type="number" class="form-control" name="m2"
											id="m2" required />
									</div>
									<div class="form-group col-md-4">
										<b>Sucursal: </b><input type="text" class="form-control"
											name="branch" value="San Justo" id="branch" required />
									</div>
								</div>
								<div class="row">
									<div class="form-group col-md-6">
										<b>Carpinteria: </b><input type="text" class="form-control"
											name="carpentry" id="carpentry" value="Ciudad Muebles" />
									</div>
									<div class="form-group col-md-4">
										<b>Estado: </b><input type="text" class="form-control"
											name="state" id="state" />
									</div>
								</div>

								<div class="row">
									<div class="form-group col-md-8">
										<b> Fecha:</b> <input type="date" required
											class="form-control" id="date" name="date" th:field="*{date}" />
									</div>
									<br>
									<div class="form-group col-md-4 capitalize">
										<button type="button" class="btn btn-primary" id="newMov">
											<b>Crear</b>
										</button>
									</div>
								</div>

							</form>
						</div>
					</div>
					<!--  
						-->
				</div>
			</div>
			<div class="col-md-8">

				<div class="panel-group" style="margin-top: 40px">


					<div class="panel panel-primary">
						<div class="panel-heading">
							<b><span th:utext="Movimientos"> </span></b>
						</div>

						<div class="panel-body">
							<table id="tableMovs"
								class="table table-striped table-responsive table-hover table-condensed">
								<thead>
									<tr>
										<th>Fecha</th>
										<th>Codigo</th>
										<th>Nombre</th>
										<th>Color</th>
										<th>Cantidad</th>
										<th>M2</th>
										<th>Estado</th>
										<th>Carpinteria</th>
										<th>Sucursal</th>
									</tr>
								</thead>
								<tr th:each="item,status: ${listmov}">
									<td th:text="${#dates.format(item.date, 'dd/MM/yyyy')}">
									<td th:text="${item.product.color}" />
									<td th:text="${item.product.description}" />
									<td th:text="${item.color}" />
									<td th:id="'td' + ${status.index}" th:text="${item.amount}" />
									<td th:text="${item.m2}" />
									<td th:text="${item.state}" />
									<td th:text="${item.carpentry}" />
									<td th:text="${item.branch}" />
								</tr>


							</table>
						</div>
					</div>
				</div>
			</div>

		</div>
	</div>
</body>
</html>

<script>
function greenRed(cell) {
	if(cell.innerHTML > 0){
		cell.style.backgroundColor="#A8F894";
	}
	else {
		cell.style.backgroundColor="#F98D6F";
	}

}
let list = $('td[id^=td]');
$.each(list, function(index, cell) {
	greenRed(cell);
});
	$('#newMov')
			.click(
					function() {
						// 						console.log($("form").serialize());
						$
								.ajax({
									type : 'POST',
									url : $("#form").attr("action"),
									data : $("form").serialize(),
									success : function(response) {
										// 				console.log("ok")
										// 				var table = $('#tableMovs');
										var table = document.getElementById(
												'tableMovs')
												.getElementsByTagName('tbody')[0];
										var row = table.insertRow(0);
										var cell1 = row.insertCell(0);
										var aux = document
												.getElementById('date').value;
										var fecha = aux.substring(8, 10) + '/'
												+ aux.substring(5, 7) + '/'
												+ aux.substring(0, 4);
										cell1.innerHTML = fecha;
										var cell2 = row.insertCell(1);

										cell2.innerHTML = document
												.getElementById('code').value;

										let cell3 = row.insertCell(2);
										let node = document
												.getElementById("productDesc").innerHTML;
										cell3.appendChild(document
												.createTextNode(node.replace(
														"<br>", "")));

										var cell4 = row.insertCell(3);
										var cell5 = row.insertCell(4);
										var cell6 = row.insertCell(5);
										var cell7 = row.insertCell(6);
										var cell8 = row.insertCell(7);
										var cell9 = row.insertCell(8);

										let colorText = document
												.getElementById("code").value;
										colorText = colorText.replace(/[0-9]/g,
												'');
										cell4.innerHTML = colorText;
										cell5.innerHTML = document
												.getElementById('amount').value;
										greenRed(cell5);
										cell6.innerHTML = document
												.getElementById('m2').value;
										cell7.innerHTML = document
												.getElementById("state").value;

										cell8.innerHTML = document
												.getElementById("carpentry").value;
										cell9.innerHTML = document
												.getElementById("branch").value;
									},
									error : function(response) {
										console.log("error")
									}
								});
					});

	// function searchProduct() {
	$('#code')
			.blur(

					function() {
						document.getElementById("code").value = document
								.getElementById("code").value.toUpperCase();
						$
								.ajax({
									type : 'GET',
									url : '/searchProduct?color='
											+ document.getElementById("code").value,
									// 		data : form,
									success : function(response) {
										document.getElementById('productDesc').innerHTML = '<br>'
												+ response;
									},
									error : function(response) {
										console.log("error")
									}
								});
					});
	// }
</script>